(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{416:function(_,v,e){_.exports=e.p+"assets/img/navigation.92d73c75.png"},417:function(_,v,e){_.exports=e.p+"assets/img/response-head.655cbf32.png"},418:function(_,v,e){_.exports=e.p+"assets/img/response-head-https.0c4987fe.png"},419:function(_,v,e){_.exports=e.p+"assets/img/Content-Type.8951e161.png"},420:function(_,v,e){_.exports=e.p+"assets/img/Content-Type-Octet-Stream.59590274.png"},525:function(_,v,e){"use strict";e.r(v);var t=e(27),s=Object(t.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("blockquote",[t("p",[_._v("从输入 "),t("code",[_._v("URL")]),_._v("到页面展示完整流程示意图")])]),_._v(" "),t("p",[t("img",{attrs:{src:e(416),alt:"navigation"}})]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("浏览器进程")]),_._v("主要负责用户交互、子进程管理和文件储存等功能。")]),_._v(" "),t("li",[t("strong",[_._v("网络进程")]),_._v("是面向渲染进程和浏览器进程等提供网络下载功能。")]),_._v(" "),t("li",[t("strong",[_._v("渲染进程")]),_._v("的主要职责是把从网络下载的 "),t("code",[_._v("HTML")]),_._v("、"),t("code",[_._v("JavaScript")]),_._v("、"),t("code",[_._v("CSS")]),_._v("、图片等资源解析为可以显示和交互的页面。因为渲染进程所有的内容都是通过网络获取的，会存在一些恶意代码利用浏览器漏洞对系统进行攻击，所以运行在渲染进程里面的代码是不被信任的。这也是为什么"),t("code",[_._v("Chrome")]),_._v("会让渲染进程运行在安全沙箱里，就是为了保证系统的安全。")])]),_._v(" "),t("ol",[t("li",[_._v("用户从"),t("strong",[_._v("浏览器进程")]),_._v("里输入请求信息")]),_._v(" "),t("li",[t("strong",[_._v("网络进程")]),_._v("发起 "),t("code",[_._v("URL")]),_._v("请求")]),_._v(" "),t("li",[_._v("服务器响应 "),t("code",[_._v("URL")]),_._v(" 请求之后，"),t("strong",[_._v("浏览器进程")]),_._v("开始准备"),t("strong",[_._v("渲染进程")])]),_._v(" "),t("li",[t("strong",[_._v("渲染进程")]),_._v("准备好之后，需要先向"),t("strong",[_._v("渲染进程")]),_._v("提交页面数据，我们称之为"),t("strong",[_._v("提交文档")]),_._v("阶段")]),_._v(" "),t("li",[t("strong",[_._v("渲染进程")]),_._v("接收完文档信息之后，便开始解析页面和加载子资源，完成页面的渲染")])]),_._v(" "),t("p",[_._v("用户发出"),t("code",[_._v("URL")]),_._v("请求到页面开始解析的这个过程，就叫做"),t("strong",[_._v("导航")])]),_._v(" "),t("h2",{attrs:{id:"从输入-url-到页面展示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从输入-url-到页面展示"}},[_._v("#")]),_._v(" 从输入 URL 到页面展示")]),_._v(" "),t("h3",{attrs:{id:"_1-用户输入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-用户输入"}},[_._v("#")]),_._v(" 1. 用户输入")]),_._v(" "),t("p",[_._v("当用户在地址栏中输入一个查询关键字时，地址栏会判断输入的关键字是搜索内容，还是请求的 "),t("code",[_._v("URL")]),_._v("。")]),_._v(" "),t("ul",[t("li",[_._v("如果是搜索内容，地址栏会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的 "),t("code",[_._v("URL")]),_._v("。")]),_._v(" "),t("li",[_._v("如果判断输入内容符合 "),t("code",[_._v("URL")]),_._v(" 规则，那么地址栏会根据规则，把这段内容加上协议，合成为完整的"),t("code",[_._v("URL")])])]),_._v(" "),t("p",[_._v("当用户输入关键字并键入回车之后，浏览器便进入加载状态,但页面显示的依然是之前打开的页面内容，这是因为需要等待提交文档阶段，页面内容才会被替换。")]),_._v(" "),t("h3",{attrs:{id:"_2-url请求过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-url请求过程"}},[_._v("#")]),_._v(" 2. "),t("code",[_._v("URL")]),_._v("请求过程")]),_._v(" "),t("p",[_._v("浏览器进程会通过进程间通信（"),t("code",[_._v("IPC")]),_._v("）把"),t("code",[_._v("URL")]),_._v(" 请求发送至网络进程，网络进程接收到 "),t("code",[_._v("URL")]),_._v(" 请求后，会在这里发起真正的 "),t("code",[_._v("URL")]),_._v(" 请求流程。")]),_._v(" "),t("p",[_._v("首先，网络进程会查找本地缓存是否缓存了该资源。如果有缓存资源，那么直接返回资源给浏览器进程；如果在缓存中没有查找到资源，那么直接进入网络请求流程。这请求前的第一步是要进行 "),t("code",[_._v("DNS")]),_._v("解析，以获取请求域名的服务器 "),t("code",[_._v("IP")]),_._v("地址。如果请求协议是 "),t("code",[_._v("HTTPS")]),_._v("，那么还需要建立 "),t("code",[_._v("TLS")]),_._v("连接。")]),_._v(" "),t("p",[_._v("接下来就是利用 "),t("code",[_._v("IP")]),_._v(" 地址和服务器建立"),t("code",[_._v("TCP")]),_._v("连接。连接建立之后，浏览器端会构建请求行、请求头等信息，并把和该域名相关的 "),t("code",[_._v("Cookie")]),_._v(" 等数据附加到请求头中，然后向服务器发送构建的请求信息。")]),_._v(" "),t("p",[_._v("服务器接收到请求信息后，会根据请求信息生成响应数据（包括响应行、响应头和响应体等信息），并发给网络进程。等网络进程接收了响应行和响应头之后，就开始解析响应头的内容了。（为了方便讲述，下面我将服务器返回的响应头和响应行统称为响应头。）")]),_._v(" "),t("h4",{attrs:{id:"_1-重定向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-重定向"}},[_._v("#")]),_._v(" （1）重定向")]),_._v(" "),t("p",[_._v("在接收到服务器返回的响应头后，网络进程开始解析响应头，如果发现返回的状态码是"),t("code",[_._v("301")]),_._v("或者 "),t("code",[_._v("302")]),_._v("，那么说明服务器需要浏览器重定向到其他 "),t("code",[_._v("URL")]),_._v("。这时网络进程会从响应头的 "),t("code",[_._v("Location")]),_._v("字段里面读取重定向的地址，然后再发起新的 "),t("code",[_._v("HTTP")]),_._v("或者 "),t("code",[_._v("HTTPS")]),_._v("请求")]),_._v(" "),t("p",[_._v("比如，我们在终端里输入以下命令：")]),_._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[_._v("curl -I http://time.geekbang.org/\n")])]),_._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[_._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:e(417),alt:"response-head"}})]),_._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[_._v("curl -I https://time.geekbang.org/\n")])]),_._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[_._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:e(418),alt:"response-head-https"}})]),_._v(" "),t("h4",{attrs:{id:"_2-响应数据类型处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-响应数据类型处理"}},[_._v("#")]),_._v(" （2）响应数据类型处理")]),_._v(" "),t("p",[t("code",[_._v("URL")]),_._v(" 请求的数据类型，有时候是一个下载类型，有时候是正常的 "),t("code",[_._v("HTML")]),_._v(" 页面，"),t("code",[_._v("HTTP")]),_._v("头中的"),t("code",[_._v("Content-Type")]),_._v(" 字段会告诉浏览器,服务器返回的响应体数据是什么类型，然后根据它的值来决定如何显示响应体的内容。")]),_._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[_._v("curl -I https://time.geekbang.org/\n")])]),_._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[_._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:e(419),alt:"Content-Type"}})]),_._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[_._v("curl -I https://res001.geekbang.org/apps/geektime/android/2.3.1/official/geektime_2.3.1_20190527-2136_offical.apk\n")])]),_._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[_._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:e(420),alt:"Content-Type"}})]),_._v(" "),t("p",[_._v("如果"),t("code",[_._v("Content-Type")]),_._v(" 字段的值被浏览器判断为下载类型，那么该请求会被提交给浏览器的下载管理器，同时该 "),t("code",[_._v("URL")]),_._v(" 请求的导航流程就此结束。但如果是"),t("code",[_._v("HTML")]),_._v("，那么浏览器则会继续进行导航流程。")]),_._v(" "),t("h3",{attrs:{id:"_3-准备渲染进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-准备渲染进程"}},[_._v("#")]),_._v(" 3. 准备渲染进程")]),_._v(" "),t("p",[_._v("同一站点（"),t("code",[_._v("same-site")]),_._v("）: 根域名+协议+该根域名下的所有子域名和不同的端口")]),_._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[_._v("https://time.geekbang.org\nhttps://www.geekbang.org\nhttps://www.geekbang.org:8080\n")])]),_._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[_._v("1")]),t("br"),t("span",{staticClass:"line-number"},[_._v("2")]),t("br"),t("span",{staticClass:"line-number"},[_._v("3")]),t("br")])]),t("p",[_._v("它们都是属于同一站点，因为它们的协议都是 "),t("code",[_._v("HTTPS")]),_._v("，而且根域名也都是 "),t("code",[_._v("geekbang.org")]),_._v("。")]),_._v(" "),t("p",[t("code",[_._v("Chrome")]),_._v(" 的默认策略是，每个标签对应一个渲染进程。但如果从一个页面打开了另一个新页面，而新页面和当前页面属于同一站点的话，那么新页面会复用父页面的渲染进程。官方把这个默认策略叫 "),t("code",[_._v("process-per-site-instance")]),_._v("。")]),_._v(" "),t("p",[_._v("渲染进程准备好之后，还不能立即进入文档解析状态，因为此时的文档数据还在网络进程中，并没有提交给渲染进程，所以下一步就进入了提交文档阶段。")]),_._v(" "),t("h3",{attrs:{id:"_4-提交文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-提交文档"}},[_._v("#")]),_._v(" 4. 提交文档")]),_._v(" "),t("blockquote",[t("p",[_._v("这里的"),t("strong",[_._v("文档")]),_._v("是指"),t("code",[_._v("URL")]),_._v("请求的响应体数据。")])]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("浏览器进程")]),_._v("向"),t("strong",[_._v("渲染进程")]),_._v("发出"),t("strong",[_._v("提交文档")]),_._v("的消息，"),t("strong",[_._v("渲染进程")]),_._v("会和"),t("strong",[_._v("网络进程")]),_._v("建立传输数据的"),t("strong",[_._v("管道")]),_._v("。")]),_._v(" "),t("li",[_._v("数据传输完成之后，"),t("strong",[_._v("渲染进程")]),_._v("向"),t("strong",[_._v("浏览器进程")]),_._v("发出"),t("strong",[_._v("确认提交")]),_._v("的消息。")]),_._v(" "),t("li",[t("strong",[_._v("浏览器进程")]),_._v("收到消息后，更新浏览器界面状态，包括了安全状态、地址栏的 "),t("code",[_._v("URL")]),_._v("、前进后退的历史状态，并更新"),t("code",[_._v("Web")]),_._v(" 页面。")])]),_._v(" "),t("blockquote",[t("p",[_._v("还没渲染,只是更新页面,应该是空白的")])]),_._v(" "),t("p",[_._v("这就是一个完整的导航流程，之后就要进入渲染阶段了。")]),_._v(" "),t("h3",{attrs:{id:"_5-渲染阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-渲染阶段"}},[_._v("#")]),_._v(" 5. 渲染阶段")]),_._v(" "),t("p",[_._v("渲染进程开始页面解析和子资源加载。页面生成后，渲染进程会发送一个消息给浏览器进程，浏览器接收到消息后，会停止标签图标上的加载动画")])])}),[],!1,null,null,null);v.default=s.exports}}]);