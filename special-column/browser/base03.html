<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP请求流程 | 草莓牛奶</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/docs/strawberry.png">
    <meta name="description" content="一个笔记本">
    <meta name="author" content="草莓牛奶">
    <meta name="Keywords" content="vuepress 介绍, vuepress 说明, 草莓牛奶">
    
    <link rel="preload" href="/docs/assets/css/0.styles.6b8e1be2.css" as="style"><link rel="preload" href="/docs/assets/js/app.7f8f8c46.js" as="script"><link rel="preload" href="/docs/assets/js/2.d854598f.js" as="script"><link rel="preload" href="/docs/assets/js/7.1c7442ef.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.873cd68b.js"><link rel="prefetch" href="/docs/assets/js/11.e2d11448.js"><link rel="prefetch" href="/docs/assets/js/12.018f9a11.js"><link rel="prefetch" href="/docs/assets/js/13.70048ddc.js"><link rel="prefetch" href="/docs/assets/js/14.c8b18b37.js"><link rel="prefetch" href="/docs/assets/js/15.234cdd2a.js"><link rel="prefetch" href="/docs/assets/js/16.aaae998b.js"><link rel="prefetch" href="/docs/assets/js/17.979a63c3.js"><link rel="prefetch" href="/docs/assets/js/18.5803a45c.js"><link rel="prefetch" href="/docs/assets/js/19.a9553c19.js"><link rel="prefetch" href="/docs/assets/js/20.e73c590a.js"><link rel="prefetch" href="/docs/assets/js/21.c99c02a9.js"><link rel="prefetch" href="/docs/assets/js/22.98c56067.js"><link rel="prefetch" href="/docs/assets/js/23.39e5abee.js"><link rel="prefetch" href="/docs/assets/js/24.aa1b6ec5.js"><link rel="prefetch" href="/docs/assets/js/25.d8adda77.js"><link rel="prefetch" href="/docs/assets/js/26.269b7ee5.js"><link rel="prefetch" href="/docs/assets/js/27.51863712.js"><link rel="prefetch" href="/docs/assets/js/28.907750b9.js"><link rel="prefetch" href="/docs/assets/js/29.8c284cfa.js"><link rel="prefetch" href="/docs/assets/js/3.9cf291d6.js"><link rel="prefetch" href="/docs/assets/js/30.11629a3c.js"><link rel="prefetch" href="/docs/assets/js/31.90b75c80.js"><link rel="prefetch" href="/docs/assets/js/32.e48935c3.js"><link rel="prefetch" href="/docs/assets/js/33.391ac225.js"><link rel="prefetch" href="/docs/assets/js/34.3889eef8.js"><link rel="prefetch" href="/docs/assets/js/35.2e36962a.js"><link rel="prefetch" href="/docs/assets/js/36.692e3b25.js"><link rel="prefetch" href="/docs/assets/js/37.303fa93d.js"><link rel="prefetch" href="/docs/assets/js/38.5f02ce83.js"><link rel="prefetch" href="/docs/assets/js/39.18a54282.js"><link rel="prefetch" href="/docs/assets/js/4.21fa4d3d.js"><link rel="prefetch" href="/docs/assets/js/40.a81940a5.js"><link rel="prefetch" href="/docs/assets/js/5.5faeb4df.js"><link rel="prefetch" href="/docs/assets/js/6.5a41e757.js"><link rel="prefetch" href="/docs/assets/js/8.237a18cb.js"><link rel="prefetch" href="/docs/assets/js/9.d857a5fc.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.6b8e1be2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="milk.png" alt="草莓牛奶" class="logo"> <span class="site-name can-hide">草莓牛奶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guide/" class="nav-link">
  Markdown语法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><span class="title">学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习" class="mobile-dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/study/javaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/git/base01.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/vue/base01.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/english/base01.html" class="nav-link">
  English
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="路线" class="dropdown-title"><span class="title">路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="路线" class="mobile-dropdown-title"><span class="title">路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/route/atguigu/base01.html" class="nav-link">
  尚硅谷
</a></li><li class="dropdown-item"><!----> <a href="/docs/route/coderwhy/base01.html" class="nav-link">
  coderwhy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="进阶" class="mobile-dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/advance/scss/base01.html" class="nav-link">
  Sass
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="读书笔记" class="mobile-dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/readingNote/theDefinitiveGuideToHTML5/part1.html" class="nav-link">
  HTML5权威指南
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow down"></span></button> <button type="button" aria-label="专栏" class="mobile-dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/special-column/browser/base01.html" class="nav-link">
  浏览器工作原理与实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhaodesen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/strawberry_milk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guide/" class="nav-link">
  Markdown语法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><span class="title">学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习" class="mobile-dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/study/javaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/git/base01.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/vue/base01.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/english/base01.html" class="nav-link">
  English
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="路线" class="dropdown-title"><span class="title">路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="路线" class="mobile-dropdown-title"><span class="title">路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/route/atguigu/base01.html" class="nav-link">
  尚硅谷
</a></li><li class="dropdown-item"><!----> <a href="/docs/route/coderwhy/base01.html" class="nav-link">
  coderwhy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="进阶" class="mobile-dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/advance/scss/base01.html" class="nav-link">
  Sass
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="读书笔记" class="mobile-dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/readingNote/theDefinitiveGuideToHTML5/part1.html" class="nav-link">
  HTML5权威指南
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow down"></span></button> <button type="button" aria-label="专栏" class="mobile-dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/special-column/browser/base01.html" class="nav-link">
  浏览器工作原理与实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhaodesen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/strawberry_milk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Browser</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/special-column/browser/base01.html" class="sidebar-link">Chrome架构</a></li><li><a href="/docs/special-column/browser/base02.html" class="sidebar-link">TCP协议</a></li><li><a href="/docs/special-column/browser/base03.html" aria-current="page" class="active sidebar-link">HTTP请求流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base03.html#浏览器端发起-http-请求流程" class="sidebar-link">浏览器端发起 HTTP 请求流程</a></li><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base03.html#服务器端处理-http-请求流程" class="sidebar-link">服务器端处理 HTTP 请求流程</a></li><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base03.html#问题解答" class="sidebar-link">问题解答</a></li></ul></li><li><a href="/docs/special-column/browser/base04.html" class="sidebar-link">导航流程</a></li><li><a href="/docs/special-column/browser/base05.html" class="sidebar-link">渲染流程</a></li><li><a href="/docs/special-column/browser/base06.html" class="sidebar-link">变量提升</a></li><li><a href="/docs/special-column/browser/base07.html" class="sidebar-link">调用栈</a></li><li><a href="/docs/special-column/browser/base08.html" class="sidebar-link">块级作用域</a></li><li><a href="/docs/special-column/browser/base09.html" class="sidebar-link">作用域链和闭包</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><code>HTTP</code> 协议，建立在 <code>TCP</code> 连接基础之上。<code>HTTP</code> 是一种允许浏览器向服务器获取资源的协议，是<code>Web</code>的基础，通常由浏览器发起请求，用来获取不同类型的文件，例如<code>HTML</code>文件、<code>CSS</code> 文件、<code>JavaScript</code>文件、图片、视频等。此外，<code>HTTP</code>也是浏览器使用最广的协议，所以要想学好浏览器，就要先深入了解 <code>HTTP</code>。</p> <h2 id="浏览器端发起-http-请求流程"><a href="#浏览器端发起-http-请求流程" class="header-anchor">#</a> 浏览器端发起 <code>HTTP</code> 请求流程</h2> <p>浏览器地址栏里键入<code>https://www.baidu.com/</code>,浏览器会完成哪些动作呢?</p> <blockquote><p><code>https</code>: 协议类型
<code>//</code> : 层级 URL 标记符号
<code>www.baidu.com</code> : 域名</p></blockquote> <h3 id="_1-构建请求"><a href="#_1-构建请求" class="header-anchor">#</a> 1. 构建请求</h3> <p>首先，浏览器构建请求行信息（如下所示），构建好后，浏览器准备发起网络请求。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>GET /index.html HTTP1.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-查找缓存"><a href="#_2-查找缓存" class="header-anchor">#</a> 2. 查找缓存</h3> <p>在真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件。其中，浏览器缓存是一种在本地保存资源副本，以供下次请求时直接使用的技术。
当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。这样做的好处有：</p> <ul><li>缓解服务器端压力，提升性能（获取资源的耗时更短了）</li> <li>对于网站来说，缓存是实现快速资源加载的重要组成部分</li></ul> <p>如果缓存查找失败，就会进入网络请求过程了。</p> <h3 id="_3-准备-ip-地址和端口"><a href="#_3-准备-ip-地址和端口" class="header-anchor">#</a> 3. 准备 <code>IP</code> 地址和端口</h3> <p>因为浏览器使用<code>HTTP</code> 协议作为应用层协议，用来封装请求的文本信息；并使用<code>TCP/IP</code> 作传输层协议将它发到网络上，所以在 <code>HTTP</code>工作开始之前，浏览器需要通过 <code>TCP</code>与服务器建立连接。也就是说<code>HTTP</code>的内容是通过<code>TCP</code>的传输数据阶段来实现的，可以结合下图更好地理解这二者的关系。
<img src="/docs/assets/img/http-and-tcp.1277f342.png" alt="http-and-tcp"></p> <p>数据包都是通过<code>IP</code>地址传输给接收方的。由于 <code>IP</code> 地址是数字标识，难以记忆，但使用域名（<code>www.baidu.com</code>）就好记多了，所以基于这个需求又出现了一个服务，负责把域名和<code>IP</code>地址做一一映射关系。这套域名映射为 <code>IP</code>的系统就叫做<strong>域名系统</strong>，简称<code>DNS</code>（<code>Domain Name System</code>）。</p> <p>浏览器首先会请求 <code>DNS</code>返回域名对应的<code>IP</code>。浏览器还提供了<code>DNS</code>数据缓存服务，如果某个域名已经解析过，就会缓存解析的结果，以供下次查询时直接使用，这样也会减少一次网络请求。</p> <p>拿到 <code>IP</code> 之后，接下来就需要获取端口号了。通常情况下，如果<code>URL</code> 没有特别指明端口号，那么 <code>HTTP</code> 协议默认是<code>80</code> 端口。</p> <h3 id="_4-等待tcp-队列"><a href="#_4-等待tcp-队列" class="header-anchor">#</a> 4. 等待<code>TCP</code> 队列</h3> <p><code>IP</code>地址和端口都准备好了，还不能建立 <code>TCP</code> 连接,因为<code>Chrome</code>有个机制，同一个域名同时最多只能建立 <code>6</code>个 <code>TCP</code> 连接，如果在同一个域名下同时有<code>10</code>个请求发生，那么其中<code>4</code>个请求会进入排队等待状态，直至进行中的请求完成。如果当前请求数量少于 <code>6</code>，会直接进入下一步，建立<code>TCP</code> 连接。</p> <h3 id="_5-建立tcp连接"><a href="#_5-建立tcp连接" class="header-anchor">#</a> 5. 建立<code>TCP</code>连接</h3> <p>排队等待结束之后， <code>HTTP</code>工作开始之前，浏览器通过<code>TCP</code>与服务器三次握手建立连接</p> <h3 id="_6-发送-http-请求"><a href="#_6-发送-http-请求" class="header-anchor">#</a> 6. 发送 <code>HTTP</code> 请求</h3> <p>一旦建立了<code>TCP</code> 连接，浏览器就可以和服务器进行通信了。而 <code>HTTP</code>中的数据正是在这个通信过程中传输的。</p> <p>可以结合下图来理解，浏览器是如何发送请求信息给服务器的。
<img src="/docs/assets/img/http-request.b8993c73.png" alt="http-request"></p> <p>首先浏览器会向服务器发送请求行，它包括了:</p> <ul><li><strong>请求方法</strong></li> <li><strong>请求 <code>URI</code></strong>（<code>Uniform Resource Identifier</code>）</li> <li><strong><code>HTTP</code> 版本协议</strong>。</li></ul> <p>发送请求行，就是告诉服务器浏览器需要什么资源，最常用的请求方法是<code>Get</code></p> <p>另外一个常用的请求方法是<code>POST</code>，用于发送一些数据给服务器，通过请求体来发送。</p> <p>在浏览器发送请求行命令之后，还要以请求头形式把浏览器的一些基础信息告诉服务器。比如:</p> <ul><li><strong>浏览器所使用的操作系统</strong></li> <li><strong>浏览器内核等信息</strong></li> <li><strong>当前请求的域名信息</strong></li> <li><strong>浏览器端的 <code>Cookie</code> 信息</strong></li> <li><strong>...</strong></li></ul> <h2 id="服务器端处理-http-请求流程"><a href="#服务器端处理-http-请求流程" class="header-anchor">#</a> 服务器端处理 <code>HTTP</code> 请求流程</h2> <p><code>HTTP</code>的请求信息被送达了服务器。服务器会根据浏览器的请求信息来准备相应的内容。</p> <h3 id="_1-返回请求"><a href="#_1-返回请求" class="header-anchor">#</a> 1. 返回请求</h3> <p>通过工具软件 <code>curl</code>来查看返回请求数据</p> <blockquote><p>windows 内置了<code>curl</code></p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -i  https:/www.baidu.com/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/docs/assets/img/response.3e30476a.png" alt="response"></p> <p>首先服务器会返回响应行，包括:</p> <ul><li><strong>协议版本</strong></li> <li><strong>状态码</strong></li></ul> <p>并不是所有的请求都可以被服务器处理，一些无法处理或者处理出错的信息,服务器会通过请求行的状态码来告诉浏览器它的处理结果</p> <ul><li><strong>状态码<code>200</code></strong> 表示处理成功</li> <li><strong>状态码<code>404</code></strong> 表示没有找到页面</li></ul> <p>随后，正如浏览器会随同请求发送请求头一样，服务器也会随同响应向浏览器发送响应头。响应头包含了:服务器自身的一些信息，比如服务器生成返回数据的时间、返回的数据类型（<code>JSON</code>、<code>HTML</code>、流媒体等类型），以及服务器要在客户端保存的 <code>Cookie</code> 等信息。</p> <p>发送完响应头后，服务器就可以继续发送响应体的数据，通常，响应体就包含了<code>HTML</code>的实际内容。</p> <h3 id="_2-断开连接"><a href="#_2-断开连接" class="header-anchor">#</a> 2. 断开连接</h3> <p>通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 <code>TCP</code> 连接。不过如果浏览器或者服务器在其头信息中加入了：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Connection:Keep-Alive

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>那么<code>TCP</code> 连接在发送后将仍然保持打开状态，这样浏览器就可以继续通过同一个 <code>TCP</code> 连接发送请求。保持 <code>TCP</code> 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。比如，一个 <code>Web</code>页面中内嵌的图片就都来自同一个<code>Web</code> 站点，如果初始化了一个持久连接，就可以复用该连接，以请求其他资源，而不需要重新再建立新的 <code>TCP</code> 连接。</p> <h3 id="_3-重定向"><a href="#_3-重定向" class="header-anchor">#</a> 3. 重定向</h3> <p>当你在浏览器中访问一个网址，发现最终打开的页面地址与之不同,说明出现了重定向操作</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl -I geekbang.org
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>-I 表示只需要获取响应头和响应行数据</p></blockquote> <p><img src="/docs/assets/img/redirect.01db98e0.png" alt="redirect"></p> <p>响应行返回的状态码是 <code>301</code>，表示告诉浏览器，需要重定向到另外一个网址，而需要重定向的网址正是包含在响应头的 <code>Location</code> 字段中，接下来，浏览器获取 Location 字段中的地址，并使用该地址重新导航</p> <p>不过也不要认为这种跳转是必然的。如果你打开 <code>https://12306.cn</code>，你会发现这个站点是打不开的。这是因为 <code>12306</code>的服务器并没有处理跳转，所以必须要手动输入完整的<code>https://www.12306.com</code>才能打开页面。</p> <h2 id="问题解答"><a href="#问题解答" class="header-anchor">#</a> 问题解答</h2> <h3 id="_1-为什么很多站点第二次打开速度会很快"><a href="#_1-为什么很多站点第二次打开速度会很快" class="header-anchor">#</a> 1. 为什么很多站点第二次打开速度会很快？</h3> <p>如果第二次页面打开很快，主要原因是第一次加载页面过程中，缓存了一些耗时的数据。</p> <p><strong><code>DNS</code>缓存</strong>和<strong>页面资源缓存</strong>这两块数据是会被浏览器缓存的。<code>DNS</code>缓存主要是在浏览器本地把对应的 <code>IP</code> 和域名关联起来</p> <p>重点看下浏览器资源缓存，下面是缓存处理的过程：
<img src="/docs/assets/img/cache.5fc2f88a.png" alt="cache"></p> <p>当服务器返回<code>HTTP</code>响应头给浏览器时，浏览器是通过响应头中的<code>Cache-Control</code> 字段来设置是否缓存该资源。通常，我们还需要为这个资源设置一个缓存过期时长，而这个时长是通过 <code>Cache-Control</code> 中的 <code>Max-age</code> 参数来设置的，比如上图设置的缓存过期时间是 <code>2000</code> 秒。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Cache-Control:Max-age=2000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在该缓存资源还未过期的情况下, 如果再次请求该资源，会直接返回缓存中的资源给浏览器。</p> <p>如果缓存过期了，浏览器则会继续发起网络请求，并且在<code>HTTP</code>请求头中带上：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>If-None-Match:&quot;4f80f-13c-3a1xb12a&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>服务器收到请求头后，会根据 <code>If-None-Match</code> 的值来判断请求的资源是否有更新。</p> <ul><li>如果没有更新，返回 <code>304</code> 状态码，相当于服务器告诉浏览器：“这个缓存可以继续使用，这次就不重复发送数据给你了。”</li> <li>如果资源有更新，服务器就直接返回最新资源给浏览器。</li></ul> <h3 id="_2-登录状态是如何保持的"><a href="#_2-登录状态是如何保持的" class="header-anchor">#</a> 2. 登录状态是如何保持的？</h3> <ul><li>用户填入用户名和密码，点击登录。提交用户登录信息给服务器。</li> <li>服务器接收到浏览器提交的信息之后，验证用户登录信息，生成表示用户身份的字符串，并把它写到响应头的<code>Set-Cookie</code>字段里，然后把响应头发送给浏览器。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>Set-Cookie: UID=3431uad;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>浏览器接收到服务器的响应头后，解析响应头，将 <code>Set-Cookie</code>字段的情况，保存到本地。</li> <li>当用户再次访问时，浏览器会在发起请求之前，读取<code>Cookie</code>数据，把数据写进请求头里的<code>Cookie</code>字段里（如下所示），然后浏览器再将请求头发送给服务器</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>Cookie: UID=3431uad;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>服务器在收到 <code>HTTP</code>请求头数据之后，查找请求头里面的<code>Cookie</code>字段信息，服务器查询后台，判断该用户是已登录状态，然后生成含有该用户信息的页面数据发送给浏览器。</li> <li>浏览器在接收到该含有当前用户的页面数据后，就可以正确展示用户登录的状态信息了。</li></ul> <p>浏览器页面状态是通过使用<code>Cookie</code>来实现的。<code>Cookie</code>流程可以参考下图：</p> <p><img src="/docs/assets/img/cookie.d9d6cefe.png" alt="cookie"></p> <p>详细的<code>HTTP</code>请求示意图
<img src="/docs/assets/img/full-http-response.1b49976a.png" alt="full-http-response"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/special-column/browser/base02.html" class="prev">
        TCP协议
      </a></span> <span class="next"><a href="/docs/special-column/browser/base04.html">
        导航流程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.7f8f8c46.js" defer></script><script src="/docs/assets/js/2.d854598f.js" defer></script><script src="/docs/assets/js/7.1c7442ef.js" defer></script>
  </body>
</html>
