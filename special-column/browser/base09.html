<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>作用域链和闭包 | 草莓牛奶</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/docs/strawberry.png">
    <meta name="description" content="一个笔记本">
    <meta name="author" content="草莓牛奶">
    <meta name="Keywords" content="vuepress 介绍, vuepress 说明, 草莓牛奶">
    
    <link rel="preload" href="/docs/assets/css/0.styles.6b8e1be2.css" as="style"><link rel="preload" href="/docs/assets/js/app.f83263f5.js" as="script"><link rel="preload" href="/docs/assets/js/2.61df76d7.js" as="script"><link rel="preload" href="/docs/assets/js/10.e017752f.js" as="script"><link rel="prefetch" href="/docs/assets/js/11.14948b35.js"><link rel="prefetch" href="/docs/assets/js/12.13209217.js"><link rel="prefetch" href="/docs/assets/js/13.f60acfdb.js"><link rel="prefetch" href="/docs/assets/js/14.f4003c8d.js"><link rel="prefetch" href="/docs/assets/js/15.ee20c976.js"><link rel="prefetch" href="/docs/assets/js/16.98308acb.js"><link rel="prefetch" href="/docs/assets/js/17.96c70e4f.js"><link rel="prefetch" href="/docs/assets/js/18.475b9e9c.js"><link rel="prefetch" href="/docs/assets/js/19.1f6e3915.js"><link rel="prefetch" href="/docs/assets/js/20.290f5347.js"><link rel="prefetch" href="/docs/assets/js/21.2df47d15.js"><link rel="prefetch" href="/docs/assets/js/22.d2c6cde0.js"><link rel="prefetch" href="/docs/assets/js/23.d9b20639.js"><link rel="prefetch" href="/docs/assets/js/24.071c5575.js"><link rel="prefetch" href="/docs/assets/js/25.16bd1dc7.js"><link rel="prefetch" href="/docs/assets/js/26.195b28e1.js"><link rel="prefetch" href="/docs/assets/js/27.73d48ab6.js"><link rel="prefetch" href="/docs/assets/js/28.31027141.js"><link rel="prefetch" href="/docs/assets/js/29.46669013.js"><link rel="prefetch" href="/docs/assets/js/3.21d58b5a.js"><link rel="prefetch" href="/docs/assets/js/30.51c5e597.js"><link rel="prefetch" href="/docs/assets/js/31.78baab02.js"><link rel="prefetch" href="/docs/assets/js/32.466e3cd8.js"><link rel="prefetch" href="/docs/assets/js/33.103c24d9.js"><link rel="prefetch" href="/docs/assets/js/34.16e16cec.js"><link rel="prefetch" href="/docs/assets/js/35.297d08e3.js"><link rel="prefetch" href="/docs/assets/js/36.f1a8004d.js"><link rel="prefetch" href="/docs/assets/js/37.27a7f22e.js"><link rel="prefetch" href="/docs/assets/js/38.d419b328.js"><link rel="prefetch" href="/docs/assets/js/39.e072de90.js"><link rel="prefetch" href="/docs/assets/js/4.4153d545.js"><link rel="prefetch" href="/docs/assets/js/40.6c2bce7c.js"><link rel="prefetch" href="/docs/assets/js/41.141a7cb3.js"><link rel="prefetch" href="/docs/assets/js/42.08a055ed.js"><link rel="prefetch" href="/docs/assets/js/43.fbb0ffb6.js"><link rel="prefetch" href="/docs/assets/js/44.c4bd1400.js"><link rel="prefetch" href="/docs/assets/js/45.35f85138.js"><link rel="prefetch" href="/docs/assets/js/46.5c7a69cf.js"><link rel="prefetch" href="/docs/assets/js/47.d3189f26.js"><link rel="prefetch" href="/docs/assets/js/48.85fcc229.js"><link rel="prefetch" href="/docs/assets/js/5.bd8e06c0.js"><link rel="prefetch" href="/docs/assets/js/6.8d5527f5.js"><link rel="prefetch" href="/docs/assets/js/7.f6894f62.js"><link rel="prefetch" href="/docs/assets/js/8.98e910b4.js"><link rel="prefetch" href="/docs/assets/js/9.acef81fd.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.6b8e1be2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="milk.png" alt="草莓牛奶" class="logo"> <span class="site-name can-hide">草莓牛奶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guide/" class="nav-link">
  Markdown语法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><span class="title">学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习" class="mobile-dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/study/javaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/git/base01.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/vue/base01.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/english/base01.html" class="nav-link">
  English
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="路线" class="dropdown-title"><span class="title">路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="路线" class="mobile-dropdown-title"><span class="title">路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/route/atguigu/base01.html" class="nav-link">
  尚硅谷
</a></li><li class="dropdown-item"><!----> <a href="/docs/route/coderwhy/base01.html" class="nav-link">
  coderwhy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="进阶" class="mobile-dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/advance/scss/base01.html" class="nav-link">
  Sass
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="读书笔记" class="mobile-dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/readingNote/theDefinitiveGuideToHTML5/part1.html" class="nav-link">
  HTML5权威指南
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow down"></span></button> <button type="button" aria-label="专栏" class="mobile-dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/special-column/browser/base01.html" class="nav-link">
  浏览器工作原理与实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhaodesen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/strawberry_milk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><span class="title">指南</span> <span class="arrow down"></span></button> <button type="button" aria-label="指南" class="mobile-dropdown-title"><span class="title">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guide/" class="nav-link">
  Markdown语法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><span class="title">学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习" class="mobile-dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/study/javaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/git/base01.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/vue/base01.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/study/english/base01.html" class="nav-link">
  English
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="路线" class="dropdown-title"><span class="title">路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="路线" class="mobile-dropdown-title"><span class="title">路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/route/atguigu/base01.html" class="nav-link">
  尚硅谷
</a></li><li class="dropdown-item"><!----> <a href="/docs/route/coderwhy/base01.html" class="nav-link">
  coderwhy
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><span class="title">进阶</span> <span class="arrow down"></span></button> <button type="button" aria-label="进阶" class="mobile-dropdown-title"><span class="title">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/advance/scss/base01.html" class="nav-link">
  Sass
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="读书笔记" class="mobile-dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/readingNote/theDefinitiveGuideToHTML5/part1.html" class="nav-link">
  HTML5权威指南
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow down"></span></button> <button type="button" aria-label="专栏" class="mobile-dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/special-column/browser/base01.html" class="nav-link">
  浏览器工作原理与实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow down"></span></button> <button type="button" aria-label="GitHub" class="mobile-dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zhaodesen" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/strawberry_milk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Browser</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/special-column/browser/base01.html" class="sidebar-link">Chrome架构</a></li><li><a href="/docs/special-column/browser/base02.html" class="sidebar-link">TCP协议</a></li><li><a href="/docs/special-column/browser/base03.html" class="sidebar-link">HTTP请求流程</a></li><li><a href="/docs/special-column/browser/base04.html" class="sidebar-link">导航流程</a></li><li><a href="/docs/special-column/browser/base05.html" class="sidebar-link">渲染流程</a></li><li><a href="/docs/special-column/browser/base06.html" class="sidebar-link">变量提升</a></li><li><a href="/docs/special-column/browser/base07.html" class="sidebar-link">调用栈</a></li><li><a href="/docs/special-column/browser/base08.html" class="sidebar-link">块级作用域</a></li><li><a href="/docs/special-column/browser/base09.html" aria-current="page" class="active sidebar-link">作用域链和闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base09.html#作用域链" class="sidebar-link">作用域链</a></li><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base09.html#词法作用域" class="sidebar-link">词法作用域</a></li><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base09.html#块级作用域中的变量查找" class="sidebar-link">块级作用域中的变量查找</a></li><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base09.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/docs/special-column/browser/base09.html#闭包是怎么回收的" class="sidebar-link">闭包是怎么回收的</a></li></ul></li><li><a href="/docs/special-column/browser/base10.html" class="sidebar-link">this</a></li><li><a href="/docs/special-column/browser/base11.html" class="sidebar-link">栈空间和堆空间</a></li><li><a href="/docs/special-column/browser/base12.html" class="sidebar-link">垃圾回收</a></li><li><a href="/docs/special-column/browser/base13.html" class="sidebar-link">编译器和解释器</a></li><li><a href="/docs/special-column/browser/base14.html" class="sidebar-link">消息队列和事件循环</a></li><li><a href="/docs/special-column/browser/base15.html" class="sidebar-link">setTimeout</a></li><li><a href="/docs/special-column/browser/base16.html" class="sidebar-link">XMLHttpRequest</a></li><li><a href="/docs/special-column/browser/base17.html" class="sidebar-link">宏任务和微任务</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> myName <span class="token operator">=</span> <span class="token string">&quot; 极客邦 &quot;</span><span class="token punctuation">;</span>
  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> myName <span class="token operator">=</span> <span class="token string">&quot; 极客时间 &quot;</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/docs/assets/img/scope-chain-one.87d8bbc2.png" alt="scope-chain-one"></p> <p>也许你的第一反应是按照调用栈的顺序来查找变量，查找方式如下：</p> <ul><li>先查找栈顶是否存在<code>myName</code> 变量，但是这里没有，所以接着往下查找 <code>foo</code> 函数中的变量。</li> <li>在<code>foo</code>函数中查找到了 <code>myName</code> 变量，这时候就使用 <code>foo</code> 函数中的 <code>myName</code>。</li></ul> <p>其实这样是不对的,应该按照作用域链的规则去找</p> <h2 id="作用域链"><a href="#作用域链" class="header-anchor">#</a> 作用域链</h2> <p>在每个执行上下文的变量环境中，都包含了一个外部引用，用来指向外部的执行上下文，我们把这个外部引用称为<code>outer</code>。</p> <p>当一段代码使用了一个变量时，<code>JavaScript</code> 引擎首先会在<strong>当前的执行上下文</strong>中查找该变量，
比如上面那段代码在查找 <code>myName</code>变量时，如果在当前的变量环境中没有查找到，那么 <code>JavaScript</code> 引擎会继续在 <code>outer</code> 所指向的执行上下文中查找</p> <p><img src="/docs/assets/img/scope-chain-two.20a83265.png" alt="scope-chain-two"></p> <p>从图中可以看出，<code>bar</code>函数和 <code>foo</code> 函数的 <code>outer</code>都是指向全局上下文的，这也就意味着如果在 <code>bar</code> 函数或者 <code>foo</code>函数中使用了外部变量，那么 <code>JavaScript</code>引擎会去全局执行上下文中查找。我们把这个查找的链条就称为<strong>作用域链</strong>。</p> <p><code>foo</code> 函数调用的<code>bar</code> 函数，那为什么<code>bar</code> 函数的外部引用是全局执行上下文，而不是 <code>foo</code> 函数的执行上下文？
这是因为在<code>JavaScript</code>执行过程中，其作用域链是由词法作用域决定的。</p> <h2 id="词法作用域"><a href="#词法作用域" class="header-anchor">#</a> 词法作用域</h2> <p>词法作用域就是指作用域是由代码中函数声明的位置来决定的，所以词法作用域是静态的作用域，通过它就能够预测代码在执行过程中如何查找标识符。
<img src="/docs/assets/img/lexical-scope-one.216433d2.png" alt="lexical-scope-one"></p> <p>词法作用域是代码阶段就决定好的，和函数是怎么调用的没有关系。</p> <h2 id="块级作用域中的变量查找"><a href="#块级作用域中的变量查找" class="header-anchor">#</a> 块级作用域中的变量查找</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> myName <span class="token operator">=</span> <span class="token string">&quot; 极客世界 &quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test1 <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> myName <span class="token operator">=</span> <span class="token string">&quot;Chrome 浏览器 &quot;</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> myName <span class="token operator">=</span> <span class="token string">&quot; 极客邦 &quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> myName <span class="token operator">=</span> <span class="token string">&quot; 极客时间 &quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myAge <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="/docs/assets/img/block-scope.25053af5.png" alt="block-scope"></p> <h2 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> myName <span class="token operator">=</span> <span class="token string">&quot; 极客时间 &quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> test2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> innerBar <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> myName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">setName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      myName <span class="token operator">=</span> newName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> innerBar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot; 极客邦 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bar<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>执行到<code>foo</code> 函数内部的 <code>return innerBar</code> 这行代码时</p> <p><img src="/docs/assets/img/closure-one.d5587b76.png" alt="closure-one">
根据词法作用域的规则，内部函数<code>getName</code>和<code>setName</code>总是可以访问它们的外部函数<code>foo</code> 中的变量</p> <p><code>foo</code>函数执行完成之后，其执行上下文从栈顶弹出了，但是由于返回的 <code>setName</code> 和 <code>getName</code>方法中使用了 <code>foo</code>函数内部的变量，所以这两个变量被保存在<code>foo</code> 函数的闭包中。而且除了 <code>setName</code> 和<code>getName</code>函数之外，其他任何地方都无法访问
<img src="/docs/assets/img/closure-two.ee7c1ca4.png" alt="closure-two"></p> <p>在 <code>JavaScript</code> 中，根据词法作用域的规则，内部函数总是可以访问其外部函数中声明的变量，当通过调用一个外部函数返回一个内部函数后，即使该外部函数已经执行结束了，但是内部函数引用外部函数的变量依然保存在内存中，我们就把这些变量的集合称为闭包。比如外部函数是<code>foo</code>，那么这些变量的集合就称为 <code>foo</code>函数的闭包。</p> <p>当执行到 <code>bar.setName</code> 方法中的<code>myName = &quot;极客邦&quot;</code>这句代码时，<code>JavaScript</code>引擎会沿着<code>当前执行上下文–&gt;foo 函数闭包–&gt; 全局执行上下文</code>的顺序来查找<code>myName</code> 变量
<img src="/docs/assets/img/closure-two.ee7c1ca4.png" alt="closure-two"></p> <p><img src="/docs/assets/img/closure-browser.40b88404.png" alt="closure-browser"></p> <p>当调用 <code>bar.getName</code> 的时候，右边 <code>Scope</code> 项就体现出了作用域链的情况：<code>Local</code>就是当前的 <code>getName</code>函数的作用域，<code>Closure(foo)</code> 是指 <code>foo</code>函数的闭包，最下面的<code>Global</code>就是指全局作用域，从<code>Local–&gt;Closure(foo)–&gt;Global</code>就是一个完整的作用域链。</p> <h2 id="闭包是怎么回收的"><a href="#闭包是怎么回收的" class="header-anchor">#</a> 闭包是怎么回收的</h2> <p>如果闭包使用不正确，会很容易造成内存泄漏</p> <ul><li>引用闭包的函数是一个全局变量，那么闭包会一直存在直到页面关闭；如果这个闭包以后不再使用的话，就会造成内存泄漏。</li> <li>引用闭包的函数是个局部变量，等函数销毁后，在下次 <code>JavaScript</code> 引擎执行垃圾回收时，判断闭包这块内容如果已经不再被使用了，那么 <code>JavaScript</code>引擎的垃圾回收器就会回收这块内存。</li></ul> <p>如果该闭包会一直使用，那么它可以作为全局变量而存在；但如果使用频率不高，而且占用内存又比较大的话，那就尽量让它成为一个局部变量。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/special-column/browser/base08.html" class="prev">
        块级作用域
      </a></span> <span class="next"><a href="/docs/special-column/browser/base10.html">
        this
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/docs/assets/js/app.f83263f5.js" defer></script><script src="/docs/assets/js/2.61df76d7.js" defer></script><script src="/docs/assets/js/10.e017752f.js" defer></script>
  </body>
</html>
